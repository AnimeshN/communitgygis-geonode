{% extends 'dashboard/base.html' %}
{% load static%}
{% block content %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<style>
    
.btn {
    /* background:rgb(255, 255, 255); */
    margin-bottom: 5px;
}
.select.highlight {
    background:rgb(26, 255, 0);
}


.collapsible {
  background-color: #777;
  color: white;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;

}

.active, .select:hover {
  background-color: #777;
}

.content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
  background-color: #f1f1f1;
  transition: height 200ms;
}


.popupimage{
  width: 500px;
}

.leaflet-popup-content-wrapper {
    background-color: transparent;
    border: transparent;
    box-shadow: none;
}

.heading{
    font-size: 20px;
    background-color: rgba(192, 211, 192, 0.315);
    text-align: center;
    font-weight: 500;

    border: 2px solid rgba(255, 0, 0, 0);
    border-radius: 15px;
    

}
</style>

<div id="side-bar" style="background-color: rgba(0, 0, 0, 0.2);">                <!-- Main container -->

  <h2 style="text-align: center;">Solid Waste Management</h2>
  <hr>
 


    <section class = 'heading'>Mumbai</section><br>
    <button class="btn select" onclick="putLayer('geonode:mmrda','mumbai')">MMRDA Boundary</button>
    <button class="btn select" onclick="putLayer('geonode:mumbai_sub_census','mumbai')">Suburban</button>
    <button class="btn select" onclick="putLayer('geonode:mumbai_city_census','mumbai')">Mumbai City</button>
    <!-- <button class="btn select" onclick="putLayer('geonode:mmrda')">Corporator Ward Boundary</button> -->
    <!-- <button class="btn select" onclick="putLayer('geonode:mmrda')">Road Network</button> -->
    <button class="btn select" onclick="putLayer('geonode:mumbai_ward_boundary_10jun','mumbai')">Ward</button><br><br>

    <section class = 'heading'>L-ward</section><br>
    <button class="btn select" onclick="putLayer('geonode:l_ward_15may','lward')">DP polygon</button>
    <button class="btn select" onclick="putLayer('geonode:railway_tracks_l_ward','lward')">Railway Track Station</button>
    <button class="btn select" onclick="putLayer('geonode:railway_tracks_l_ward','lward')">Railway buffer</button>
    
    <button class="btn select" onclick="putLayer('geonode:rajeha','lward')">Surveyed Building</button>
    <button class="btn select" onclick="putLayer('geonode:metro_line_1_l_ward','lward')">Metro Rail Line 1</button>
    <button class="btn select" onclick="putLayer('geonode:metro_line_2_3_l_ward','lward')">Metro Rail Line 2 and 3</button>
    <button class="btn select" onclick="putLayer('geonode:high_voltage_lines_l_ward','lward')">High voltage Line</button>
    <button class="btn select" onclick="putLayer('geonode:buffer_for_high_voltage_lines_l_ward','lward')">HVL buffer</button>
    <button class="btn select" onclick="putLayer('geonode:crz_buffer','lward')">CRZ buffer</button><br><br>




    <section class = 'heading'>S-ward</section><br>
    <button class="btn select" onclick="putLayer('geonode:s_ward_all_polygone_1','sward')">DP polygon</button>
    <button class="btn select" onclick="putLayer('geonode:s_ward_railwaytrack_station_15jan_dhiraj','sward')">Railway Track Station</button>
    <button class="btn select" onclick="putLayer('geonode:s_ward_bufferforrailway_15jan_dhiraj','sward')">Railway buffer</button>
    <button class="btn select" onclick="putLayer('geonode:s_ward_metrorailline1_station_15jan_dhiraj','sward')">Metro Rail Line-Station</button>
    <button class="btn select" onclick="putLayer('geonode:s_ward_pond_18th_jan_digvijay','sward')">Ponds</button>
    <button class="btn select" onclick="putLayer('geonode:s_ward_high_voltage_line_16jan_kajal','sward')">High voltage Line</button>
    <button class="btn select" onclick="putLayer('geonode:s_ward_bufferforrailway_15jan_dhiraj','sward')">HVL buffer</button>
    <button class="btn select" onclick="putLayer('geonode:s_ward_flyover_bridge_17jan_kajal','sward')">Flyover Bridge</button><br><br>

    <section class = 'heading'>H west-ward</section><br>
    <button class="btn select" onclick="putLayer('geonode:hwest_osm_buildings','hwestward')">Buildings</button><br><br>



    <section class = 'heading'>Pune</section><br>
    <button class="btn btn-primary" onclick="displayPolygon('building_footprint')">Building Footprint</button>
    <button class="btn btn-primary" onclick="displayPolygon('road_Network')">Road Network</button>
    <button class="btn btn-primary" onclick="displayPoint()">Waste Collection Points</button>
    <button class="btn btn-danger" onclick="clearLayer()">Clear Layer</button>

    
<div style="text-align: center"> 
        <button style="display: inline-block ;position: relative;top: 100px" id="closebutton" name="closebutton" class="btn btn-secondary"><span class="glyphicon glyphicon-off"></span></button> 
    </div> 
</div>


    <script>
       
     var myLayerList = [];
     var LayerList = [];
     function setmap(area){
        if(area === 'mumbai'){
            mymap.setView([19.1056518,72.7815566], 11);
        }else if(area === 'lward'){
            mymap.setView([19.0790, 72.9080], 13);
        }else if(area === 'sward'){
            mymap.setView([19.1334, 72.9133], 13);
        }else if(area === 'hwestward'){
            mymap.setView([19.06251,72.8276],16);
        }

     }
    function putLayer(geonode_source,area){
        setmap(area);
        var index = myLayerList.indexOf(geonode_source);
        if(index >= 0){
            // console.log('remove'+geonode_source)
            source.getLayer(geonode_source).addTo(mymap).remove(mymap);
            myLayerList.splice(index,1);

        }else{
            // console.log('add'+geonode_source);
            // info.toFront(geonode_);
            source.getLayer(geonode_source).addTo(mymap);
            myLayerList.push(geonode_source);
        }
    }


const domain = ['https://makerghat.urbansciences.in/','http://localhost/'];

var rootUrl = domain[0] + 'geoserver/geonode/ows';

var defaultParameters = {
service: 'WFS',
version: '1.0.0',
request: 'GetFeature',
outputFormat: 'application/json'
};


function clearLayer(){
    LayerList.forEach(layer => mymap.removeLayer(layer));
    
}

function style(feature) {
    if(feature.properties.highway){
        return{
        fillColor: "#fff",
        weight: 2,
        opacity: 1,
        color: 'black',
        fillOpacity: 0
        }
    }else{
        return {
        fillColor: '#f00',
		weight: 2,
		opacity: 1,
		color: 'white',
		fillOpacity: 0.7
    };
    }
    
}


function displayPolygon(option){
tempURL = defaultParameters;
if(option==='building_footprint'){
tempURL.typeName = 'geonode:pune_buildings';
}else if(option ==='road_Network'){
    tempURL.typeName = 'geonode:pune_roads_geo';
}

var parameters = L.Util.extend(tempURL);
layer_url = rootUrl + L.Util.getParamString(parameters);
// LayerList.forEach(layer => mymap.removeLayer(layer));
mymap.spin(true,{lines: 9, length: 2, width: 20, scale: 60,radius: 70, color: "grey"});

fetch(layer_url)
.then(
    function(response) {
    if (response.status !== 200) {
        console.log('Looks like there was a problem. Status Code: ' +
        response.status);
        return;
    }

    // Examine the text in the response
    response.json().then(function(geojsonData) {
        mymap.setView([18.59414,73.79907], 16);
        geojson = L.geoJson(geojsonData.features, {
        style : style
    }).addTo(mymap);
    LayerList.push(geojson);
    mymap.spin(false);


    });


    }
)
.catch(function(err) {
    console.log('Fetch Error :-S', err);
});

    
}

function onEachFeaturePoint(feature, layer) {
	// does this feature have a property named popupContent?
    var str1 = "<img class = 'popupimage' src='/static/swm/swm_pune_pics/".concat(feature.properties.Name);
    var str2 = str1.concat("' alt='talian Trulli'>");
    layer.bindPopup(str2);

	
}
function displayPoint(){
mymap.spin(true,{lines: 9, length: 2, width: 20, scale: 60,radius: 70, color: "grey"});
tempURL = defaultParameters;
tempURL.typeName = 'geonode:pune_photo_loc';
var parameters = L.Util.extend(tempURL);
point_url = rootUrl + L.Util.getParamString(parameters)
var geojsonMarkerOptions = {
	radius: 8,
	fillColor: "#ff7800",
	color: "#000",
	weight: 1,
	opacity: 1,
	fillOpacity: 0.8
};

fetch(point_url)
.then(
    function(response) {
    if (response.status !== 200) {
        console.log('Looks like there was a problem. Status Code: ' +
        response.status);
        return;
    }

    // Examine the text in the response
    response.json().then(function(stressData) {
        mymap.setView([18.59376,73.79308],16);
        geojson = L.geoJson(stressData.features,{
	    pointToLayer: function (feature, latlng) {
		return L.circleMarker(latlng, geojsonMarkerOptions);
	},onEachFeature: onEachFeaturePoint
});
    LayerList.push(geojson);
    mymap.addLayer(geojson);
    mymap.spin(false);
    });


    }
)
.catch(function(err) {
    console.log('Fetch Error :-S', err);
});

    
}





    $('.select').click(function () {
        $(this).toggleClass('highlight')
    })


var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}
    </script>



{% endblock %}